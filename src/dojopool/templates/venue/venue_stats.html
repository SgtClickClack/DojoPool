{% extends "venue/base_venue.html" %} {% block head %} {{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %} {% block venue_content %}
<div class="venue-stats-container">
  <div class="stats-header">
    <h1 class="neon-text">{{ venue.name }} Statistics</h1>
    <div class="stats-filters">
      <select id="time-range" class="gaming-select">
        <option value="day">Last 24 Hours</option>
        <option value="week">Last Week</option>
        <option value="month">Last Month</option>
        <option value="year">Last Year</option>
      </select>
    </div>
  </div>

  <div class="stats-grid">
    <!-- Player Activity -->
    <div class="stats-card gaming-card">
      <h3><i class="fas fa-users"></i> Player Activity</h3>
      <div class="chart-container">
        <canvas id="playerActivityChart"></canvas>
      </div>
      <div class="stats-summary">
        <div class="summary-item">
          <span class="summary-label">Peak Players</span>
          <span class="summary-value">{{ stats.peak_players }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Average Players</span>
          <span class="summary-value">{{ stats.avg_players }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Check-ins</span>
          <span class="summary-value">{{ stats.total_checkins }}</span>
        </div>
      </div>
    </div>

    <!-- Table Usage -->
    <div class="stats-card gaming-card">
      <h3><i class="fas fa-table"></i> Table Usage</h3>
      <div class="chart-container">
        <canvas id="tableUsageChart"></canvas>
      </div>
      <div class="stats-summary">
        <div class="summary-item">
          <span class="summary-label">Peak Usage</span>
          <span class="summary-value">{{ stats.peak_table_usage }}%</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Average Usage</span>
          <span class="summary-value">{{ stats.avg_table_usage }}%</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Most Used Table</span>
          <span class="summary-value">Table {{ stats.most_used_table }}</span>
        </div>
      </div>
    </div>

    <!-- Tournament Stats -->
    <div class="stats-card gaming-card">
      <h3><i class="fas fa-trophy"></i> Tournament Statistics</h3>
      <div class="chart-container">
        <canvas id="tournamentStatsChart"></canvas>
      </div>
      <div class="stats-summary">
        <div class="summary-item">
          <span class="summary-label">Total Tournaments</span>
          <span class="summary-value">{{ stats.total_tournaments }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Average Players</span>
          <span class="summary-value">{{ stats.avg_tournament_players }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Total Prize Pool</span>
          <span class="summary-value">${{ stats.total_prize_pool }}</span>
        </div>
      </div>
    </div>

    <!-- Peak Hours -->
    <div class="stats-card gaming-card">
      <h3><i class="fas fa-clock"></i> Peak Hours</h3>
      <div class="chart-container">
        <canvas id="peakHoursChart"></canvas>
      </div>
      <div class="stats-summary">
        <div class="summary-item">
          <span class="summary-label">Busiest Day</span>
          <span class="summary-value">{{ stats.busiest_day }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Busiest Time</span>
          <span class="summary-value">{{ stats.busiest_time }}</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Average Wait Time</span>
          <span class="summary-value">{{ stats.avg_wait_time }} min</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Stats Table -->
  <div class="detailed-stats gaming-card">
    <h3><i class="fas fa-list"></i> Detailed Statistics</h3>
    <table class="stats-table">
      <thead>
        <tr>
          <th>Metric</th>
          <th>Current</th>
          <th>Previous</th>
          <th>Change</th>
        </tr>
      </thead>
      <tbody>
        {% for metric in detailed_stats %}
        <tr>
          <td>{{ metric.name }}</td>
          <td>{{ metric.current }}</td>
          <td>{{ metric.previous }}</td>
          <td
            class="change-cell {% if metric.change > 0 %}positive{% elif metric.change < 0 %}negative{% endif %}"
          >
            {{ metric.change }}%
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script>
  // Chart configurations and data
  const playerActivityData = {{ stats.player_activity_data| tojson }};
  const tableUsageData = {{ stats.table_usage_data| tojson }};
  const tournamentData = {{ stats.tournament_data| tojson }};
  const peakHoursData = {{ stats.peak_hours_data| tojson }};

  // Initialize charts
  document.addEventListener('DOMContentLoaded', function () {
      // Player Activity Chart
      new Chart(document.getElementById('playerActivityChart'), {
          type: 'line',
          data: playerActivityData,
          options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                  legend: {
                      position: 'top',
                  }
              }
          }
      });

      // Table Usage Chart
      new Chart(document.getElementById('tableUsageChart'), {
          type: 'bar',
          data: tableUsageData,
          options: {
              responsive: true,
              maintainAspectRatio: false
          }
      });

      // Tournament Stats Chart
      new Chart(document.getElementById('tournamentStatsChart'), {
          type: 'pie',
          data: tournamentData,
          options: {
              responsive: true,
              maintainAspectRatio: false
          }
      });

      // Peak Hours Chart
      new Chart(document.getElementById('peakHoursChart'), {
          type: 'line',
          data: peakHoursData,
          options: {
              responsive: true,
              maintainAspectRatio: false
          }
      });
  });

  // Time range selector handler
  document.getElementById('time-range').addEventListener('change', function (e) {
      // Update charts based on selected time range
      fetch(`/api/v1/venues/${venueId}/stats?range=${e.target.value}`)
          .then(response => response.json())
          .then(data => {
              // Update charts with new data
              updateCharts(data);
          })
          .catch(error => console.error('Error fetching stats:', error));
  });
</script>
{% endblock %}
