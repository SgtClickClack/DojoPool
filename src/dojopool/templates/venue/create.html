{% extends "venue/base_venue.html" %} {% block venue_content %}
<div class="venue-form-container">
  <h1 class="neon-text">Create New Venue</h1>

  <form id="venueForm" class="gaming-card">
    <!-- Basic Information -->
    <div class="form-section">
      <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
      <div class="form-group">
        <label for="name">Venue Name</label>
        <input
          type="text"
          id="name"
          name="name"
          class="gaming-input"
          required
        />
      </div>
      <div class="form-group">
        <label for="address">Address</label>
        <input
          type="text"
          id="address"
          name="address"
          class="gaming-input"
          required
        />
      </div>
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" name="phone" class="gaming-input" />
        </div>
        <div class="form-group col-md-6">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" class="gaming-input" />
        </div>
      </div>
    </div>

    <!-- Operating Hours -->
    <div class="form-section">
      <h3><i class="fas fa-clock"></i> Operating Hours</h3>
      {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday',
      'Saturday', 'Sunday'] %}
      <div class="form-row hours-row">
        <div class="form-group col-md-3">
          <label>{{ day }}</label>
        </div>
        <div class="form-group col-md-4">
          <input
            type="time"
            class="gaming-input"
            name="hours_{{ day.lower() }}_open"
            required
          />
        </div>
        <div class="form-group col-md-1 text-center">
          <span>to</span>
        </div>
        <div class="form-group col-md-4">
          <input
            type="time"
            class="gaming-input"
            name="hours_{{ day.lower() }}_close"
            required
          />
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Tables -->
    <div class="form-section">
      <h3><i class="fas fa-table"></i> Tables</h3>
      <div class="form-group">
        <label for="total_tables">Number of Tables</label>
        <input
          type="number"
          id="total_tables"
          name="total_tables"
          class="gaming-input"
          min="1"
          required
        />
      </div>
    </div>

    <!-- Amenities -->
    <div class="form-section">
      <h3><i class="fas fa-concierge-bell"></i> Amenities</h3>
      <div class="amenities-grid">
        {% for amenity in [ ('bar', 'Bar'), ('food', 'Food Service'),
        ('parking', 'Parking'), ('wifi', 'Wi-Fi'), ('lockers', 'Lockers'),
        ('pro_shop', 'Pro Shop'), ('lessons', 'Lessons'), ('tournaments',
        'Tournaments'), ('spectator_area', 'Spectator Area'), ('practice_area',
        'Practice Area') ] %}
        <div class="amenity-checkbox">
          <input
            type="checkbox"
            id="amenity_{{ amenity[0] }}"
            name="amenities"
            value="{{ amenity[0] }}"
          />
          <label for="amenity_{{ amenity[0] }}">
            <i class="fas fa-check"></i>
            {{ amenity[1] }}
          </label>
        </div>
        {% endfor %}
      </div>
    </div>

    <div class="form-actions">
      <button
        type="button"
        class="gaming-button"
        onclick="window.history.back()"
      >
        Cancel
      </button>
      <button type="submit" class="gaming-button success">Create Venue</button>
    </div>
  </form>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script>
  document
    .getElementById('venueForm')
    .addEventListener('submit', async function (e) {
      e.preventDefault();
      showLoading();

      try {
        // Gather operating hours
        const operatingHours = {};
        [
          'monday',
          'tuesday',
          'wednesday',
          'thursday',
          'friday',
          'saturday',
          'sunday',
        ].forEach((day) => {
          const open = document.querySelector(
            `[name="hours_${day}_open"]`
          ).value;
          const close = document.querySelector(
            `[name="hours_${day}_close"]`
          ).value;
          operatingHours[day] = `${open}-${close}`;
        });

        // Gather amenities
        const amenities = Array.from(
          document.querySelectorAll('input[name="amenities"]:checked')
        ).map((checkbox) => ({
          name: checkbox.value,
          icon: getAmenityIcon(checkbox.value),
        }));

        const formData = {
          name: document.getElementById('name').value,
          address: document.getElementById('address').value,
          phone: document.getElementById('phone').value,
          email: document.getElementById('email').value,
          operating_hours: operatingHours,
          total_tables: parseInt(document.getElementById('total_tables').value),
          amenities: amenities,
        };

        const response = await fetch('/venues/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });

        const data = await response.json();

        if (response.ok) {
          showToast('Venue created successfully', 'success');
          window.location.href = `/venues/${data.id}`;
        } else {
          showToast(data.error || 'Failed to create venue');
        }
      } catch (error) {
        showToast('An error occurred while creating the venue');
        console.error('Venue creation error:', error);
      } finally {
        hideLoading();
      }
    });

  function getAmenityIcon(amenity) {
    const icons = {
      bar: 'fa-glass-martini',
      food: 'fa-utensils',
      parking: 'fa-parking',
      wifi: 'fa-wifi',
      lockers: 'fa-lock',
      pro_shop: 'fa-store',
      lessons: 'fa-chalkboard-teacher',
      tournaments: 'fa-trophy',
      spectator_area: 'fa-users',
      practice_area: 'fa-bullseye',
    };
    return icons[amenity] || 'fa-check';
  }
</script>
{% endblock %}
