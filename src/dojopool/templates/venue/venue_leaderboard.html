{% extends "venue/base_venue.html" %}

{% block venue_content %}
<div class="venue-leaderboard-container">
    <div class="leaderboard-header">
        <h1 class="neon-text">{{ venue.name }} Leaderboard</h1>
        <div class="leaderboard-filters">
            <select id="time-period" class="gaming-select">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="all-time">All Time</option>
            </select>
            <select id="game-type" class="gaming-select">
                <option value="all">All Games</option>
                <option value="8-ball">8-Ball</option>
                <option value="9-ball">9-Ball</option>
                <option value="straight">Straight Pool</option>
            </select>
        </div>
    </div>

    <!-- Top Players Podium -->
    <div class="top-players-podium gaming-card">
        {% if top_players|length >= 3 %}
        <div class="podium-container">
            <!-- Second Place -->
            <div class="podium-place second">
                <div class="player-avatar">
                    <img src="{{ top_players[1].avatar_url }}" alt="{{ top_players[1].username }}">
                    <span class="rank">2</span>
                </div>
                <div class="player-info">
                    <h3>{{ top_players[1].username }}</h3>
                    <p class="score">{{ top_players[1].score }} pts</p>
                </div>
            </div>

            <!-- First Place -->
            <div class="podium-place first">
                <div class="player-avatar">
                    <img src="{{ top_players[0].avatar_url }}" alt="{{ top_players[0].username }}">
                    <span class="rank">1</span>
                </div>
                <div class="player-info">
                    <h3>{{ top_players[0].username }}</h3>
                    <p class="score">{{ top_players[0].score }} pts</p>
                </div>
            </div>

            <!-- Third Place -->
            <div class="podium-place third">
                <div class="player-avatar">
                    <img src="{{ top_players[2].avatar_url }}" alt="{{ top_players[2].username }}">
                    <span class="rank">3</span>
                </div>
                <div class="player-info">
                    <h3>{{ top_players[2].username }}</h3>
                    <p class="score">{{ top_players[2].score }} pts</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Full Leaderboard -->
    <div class="leaderboard-table gaming-card">
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Games</th>
                    <th>Win Rate</th>
                    <th>High Break</th>
                    <th>Points</th>
                    <th>Trend</th>
                </tr>
            </thead>
            <tbody>
                {% for player in leaderboard %}
                <tr class="{% if current_user.id == player.id %}highlight{% endif %}">
                    <td class="rank">
                        {% if player.rank <= 3 %} <span class="rank-badge rank-{{ player.rank }}">{{ player.rank
                            }}</span>
                            {% else %}
                            {{ player.rank }}
                            {% endif %}
                    </td>
                    <td class="player-cell">
                        <img src="{{ player.avatar_url }}" alt="{{ player.username }}" class="player-avatar">
                        <span class="player-name">{{ player.username }}</span>
                    </td>
                    <td>{{ player.games_played }}</td>
                    <td>{{ "%.1f"|format(player.win_rate) }}%</td>
                    <td>{{ player.high_break }}</td>
                    <td class="points">{{ player.score }}</td>
                    <td class="trend">
                        {% if player.trend > 0 %}
                        <span class="trend-up"><i class="fas fa-arrow-up"></i> {{ player.trend }}</span>
                        {% elif player.trend < 0 %} <span class="trend-down"><i class="fas fa-arrow-down"></i> {{
                            player.trend }}</span>
                            {% else %}
                            <span class="trend-neutral"><i class="fas fa-minus"></i></span>
                            {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Achievement Showcase -->
    <div class="achievement-showcase gaming-card">
        <h3><i class="fas fa-award"></i> Recent Achievements</h3>
        <div class="achievement-grid">
            {% for achievement in recent_achievements %}
            <div class="achievement-card">
                <div class="achievement-icon">
                    <i class="fas {{ achievement.icon }}"></i>
                </div>
                <div class="achievement-info">
                    <h4>{{ achievement.title }}</h4>
                    <p>{{ achievement.description }}</p>
                    <span class="achievement-date">{{ achievement.date|timeago }}</span>
                </div>
                <div class="player-info">
                    <img src="{{ achievement.player.avatar_url }}" alt="{{ achievement.player.username }}">
                    <span>{{ achievement.player.username }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block venue_sidebar %}
<aside class="venue-sidebar gaming-card">
    {% if current_user.is_authenticated %}
    <div class="player-stats">
        <h3>Your Stats</h3>
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">Current Rank</span>
                <span class="stat-value">{{ user_stats.rank }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Points</span>
                <span class="stat-value">{{ user_stats.score }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Games Played</span>
                <span class="stat-value">{{ user_stats.games_played }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Win Rate</span>
                <span class="stat-value">{{ "%.1f"|format(user_stats.win_rate) }}%</span>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="venue-records">
        <h3>Venue Records</h3>
        <ul class="records-list">
            {% for record in venue_records %}
            <li>
                <span class="record-label">{{ record.name }}</span>
                <span class="record-value">{{ record.value }}</span>
                <span class="record-holder">by {{ record.player }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>
</aside>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    // Handle filter changes
    document.getElementById('time-period').addEventListener('change', updateLeaderboard);
    document.getElementById('game-type').addEventListener('change', updateLeaderboard);

    function updateLeaderboard() {
        const timePeriod = document.getElementById('time-period').value;
        const gameType = document.getElementById('game-type').value;

        // Show loading indicator
        document.getElementById('loading-indicator').style.display = 'block';

        // Fetch updated leaderboard data
        fetch(`/api/v1/venues/${venueId}/leaderboard?period=${timePeriod}&game=${gameType}`)
            .then(response => response.json())
            .then(data => {
                // Update the leaderboard content
                updateLeaderboardContent(data);
                document.getElementById('loading-indicator').style.display = 'none';
            })
            .catch(error => {
                console.error('Error updating leaderboard:', error);
                document.getElementById('loading-indicator').style.display = 'none';
            });
    }

    function updateLeaderboardContent(data) {
        // Update podium
        // Update table
        // Update achievements
        // Implementation details...
    }
</script>
{% endblock %}