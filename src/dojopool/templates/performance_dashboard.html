{% extends "base.html" %}

{% block title %}Performance Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Image Performance Dashboard</h1>

    <!-- Current Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-2">Total Images</h3>
            <p class="text-3xl font-bold">{{ metrics.current.total_images }}</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-2">Size Reduction</h3>
            <p class="text-3xl font-bold">{{ "%.1f"|format(metrics.current.size_reduction) }}%</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-2">AVIF Adoption</h3>
            <p class="text-3xl font-bold">{{ "%.1f"|format(metrics.current.avif_adoption) }}%</p>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-2">Lazy Loading</h3>
            <p class="text-3xl font-bold">{{ "%.1f"|format(metrics.current.lazy_loading) }}%</p>
        </div>
    </div>

    <!-- Historical Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Size Trends -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-xl font-semibold mb-4">Size Optimization Trends</h3>
            <canvas id="sizeChart"></canvas>
        </div>

        <!-- Format Adoption -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-xl font-semibold mb-4">Format Adoption Trends</h3>
            <canvas id="formatChart"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Size Optimization Chart
    const sizeCtx = document.getElementById('sizeChart').getContext('2d');
    new Chart(sizeCtx, {
        type: 'line',
        data: {
            labels: {{ dates| tojson }},
        datasets: [{
            label: 'Total Size (MB)',
            data: {{ size_trends| tojson }},
        borderColor: 'rgb(75, 192, 192)',
        tension: 0.1
        }]
    },
        options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Image Size Optimization Over Time'
            }
        }
    }
});

    // Format Adoption Chart
    const formatCtx = document.getElementById('formatChart').getContext('2d');
    new Chart(formatCtx, {
        type: 'line',
        data: {
            labels: {{ dates| tojson }},
        datasets: [{
            label: 'AVIF Adoption',
            data: {{ avif_trends| tojson }},
        borderColor: 'rgb(54, 162, 235)',
        tension: 0.1
        }, {
            label: 'WebP Adoption',
            data: {{ webp_trends| tojson }},
        borderColor: 'rgb(255, 99, 132)',
        tension: 0.1
        }]
    },
        options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Image Format Adoption Over Time'
            }
        }
    }
});
</script>
{% endblock %}