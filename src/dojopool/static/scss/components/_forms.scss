@use '../abstracts/variables' as *;
@use '../abstracts/mixins' as *;

// Form group
.form-group {
  margin-bottom: spacing(4);
}

// Form label
.form-label {
  display: block;
  margin-bottom: spacing(2);
  @include font-size(sm);
  @include font-weight(medium);
  color: color(neutral, 700);

  &.required::after {
    content: '*';
    margin-left: spacing(1);
    color: color(error, 500);
  }
}

// Form text
.form-text {
  margin-top: spacing(1);
  @include font-size(sm);
  color: color(neutral, 600);
}

// Form control base
.form-control {
  display: block;
  width: 100%;
  padding: spacing(2) spacing(3);
  @include font-size(base);
  line-height: map-get($line-height, normal);
  color: color(neutral, 900);
  background-color: white;
  background-clip: padding-box;
  border: 1px solid color(neutral, 300);
  @include rounded;
  @include transition(border-color, box-shadow);

  // Placeholder
  &::placeholder {
    color: color(neutral, 400);
    opacity: 1;
  }

  // Disabled state
  &:disabled,
  &[readonly] {
    background-color: color(neutral, 100);
    opacity: 1;
    cursor: not-allowed;
  }

  // Focus state
  &:focus {
    border-color: color(primary, 500);
    @include focus-ring;
  }

  // Error state
  &.is-invalid {
    border-color: color(error, 500);
    padding-right: spacing(10);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right spacing(3) center;
    background-size: spacing(4) spacing(4);

    &:focus {
      border-color: color(error, 500);
      box-shadow: 0 0 0 0.2rem rgba(color(error, 500), 0.25);
    }
  }

  // Success state
  &.is-valid {
    border-color: color(success, 500);
    padding-right: spacing(10);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='M2.3 6.73.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right spacing(3) center;
    background-size: spacing(4) spacing(4);

    &:focus {
      border-color: color(success, 500);
      box-shadow: 0 0 0 0.2rem rgba(color(success, 500), 0.25);
    }
  }
}

// Select
select.form-control {
  padding-right: spacing(8);
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right spacing(3) center;
  background-size: spacing(4) spacing(4);

  &[multiple],
  &[size]:not([size='1']) {
    padding-right: spacing(3);
    background-image: none;
  }
}

// Textarea
textarea.form-control {
  min-height: spacing(24);
  resize: vertical;
}

// Checkbox and radio
.form-check {
  display: block;
  min-height: spacing(5);
  padding-left: spacing(6);
  margin-bottom: spacing(2);

  &:last-child {
    margin-bottom: 0;
  }
}

.form-check-input {
  float: left;
  margin-left: -#{spacing(6)};
  width: spacing(4);
  height: spacing(4);
  margin-top: spacing(0.5);
  vertical-align: top;
  background-color: white;
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
  border: 1px solid color(neutral, 400);
  appearance: none;
  @include transition(background-color, border-color, box-shadow);

  &[type='checkbox'] {
    @include rounded(sm);
  }

  &[type='radio'] {
    border-radius: 50%;
  }

  &:checked {
    background-color: color(primary, 500);
    border-color: color(primary, 500);

    &[type='checkbox'] {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='m6 10 3 3 6-6'/%3e%3c/svg%3e");
    }

    &[type='radio'] {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='2' fill='%23fff'/%3e%3c/svg%3e");
    }
  }

  &:focus {
    border-color: color(primary, 500);
    @include focus-ring;
  }

  &:disabled {
    pointer-events: none;
    filter: none;
    opacity: 0.5;
  }
}

.form-check-label {
  display: inline-block;
  color: color(neutral, 700);
  cursor: pointer;
}

// Switch
.form-switch {
  padding-left: spacing(10);

  .form-check-input {
    width: spacing(8);
    margin-left: -#{spacing(10)};
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='rgba%280, 0, 0, 0.25%29'/%3e%3c/svg%3e");
    background-position: left center;
    @include rounded(full);
    @include transition(background-position);

    &:focus {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%2386b7fe'/%3e%3c/svg%3e");
    }

    &:checked {
      background-position: right center;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
    }
  }
}

// Input group
.input-group {
  position: relative;
  display: flex;
  flex-wrap: wrap;
  align-items: stretch;
  width: 100%;

  > .form-control {
    position: relative;
    flex: 1 1 auto;
    width: 1%;
    min-width: 0;

    &:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    &:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
  }
}

.input-group-text {
  display: flex;
  align-items: center;
  padding: spacing(2) spacing(3);
  @include font-size(base);
  @include font-weight(normal);
  line-height: map-get($line-height, normal);
  color: color(neutral, 700);
  text-align: center;
  white-space: nowrap;
  background-color: color(neutral, 100);
  border: 1px solid color(neutral, 300);

  &:first-child {
    border-right: 0;
    @include rounded(base 0 0 base);
  }

  &:last-child {
    border-left: 0;
    @include rounded(0 base base 0);
  }
}

// Form validation
.invalid-feedback {
  display: none;
  width: 100%;
  margin-top: spacing(1);
  @include font-size(sm);
  color: color(error, 500);

  .form-control.is-invalid ~ & {
    display: block;
  }
}

.valid-feedback {
  display: none;
  width: 100%;
  margin-top: spacing(1);
  @include font-size(sm);
  color: color(success, 500);

  .form-control.is-valid ~ & {
    display: block;
  }
}

// Form floating labels
.form-floating {
  position: relative;

  > .form-control {
    height: spacing(14);
    padding: spacing(4) spacing(3);

    &::placeholder {
      color: transparent;
    }

    &:focus,
    &:not(:placeholder-shown) {
      padding-top: spacing(6);
      padding-bottom: spacing(2);

      ~ label {
        opacity: 0.65;
        transform: scale(0.85) translateY(-#{spacing(4)});
      }
    }
  }

  > label {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    padding: spacing(4) spacing(3);
    pointer-events: none;
    border: 1px solid transparent;
    transform-origin: 0 0;
    @include transition(opacity, transform);
  }
}
