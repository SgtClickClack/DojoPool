<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live AI Commentary Test - DojoPool</title>
    <style>
      body {
        font-family: 'Courier New', monospace;
        background: linear-gradient(135deg, #0f0f23, #1a1a2e);
        color: #00ff41;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #00ff41;
      }
      h1 {
        text-align: center;
        color: #00ff41;
        text-shadow: 0 0 10px #00ff41;
        margin-bottom: 30px;
      }
      .control-panel {
        background: rgba(0, 255, 65, 0.1);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #00ff41;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select,
      button {
        width: 100%;
        padding: 10px;
        border: 1px solid #00ff41;
        background: rgba(0, 0, 0, 0.8);
        color: #00ff41;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
      }
      button {
        background: #00ff41;
        color: #000;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      button:hover {
        background: #00cc33;
        box-shadow: 0 0 15px #00ff41;
      }
      .commentary-display {
        background: rgba(0, 0, 0, 0.9);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #00ff41;
        min-height: 200px;
        overflow-y: auto;
      }
      .commentary-item {
        background: rgba(0, 255, 65, 0.1);
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        border-left: 4px solid #00ff41;
      }
      .commentary-text {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .commentary-details {
        font-size: 12px;
        color: #888;
      }
      .status {
        text-align: center;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .status.connected {
        background: rgba(0, 255, 65, 0.2);
        color: #00ff41;
      }
      .status.disconnected {
        background: rgba(255, 0, 0, 0.2);
        color: #ff4444;
      }
      .shot-history {
        background: rgba(0, 0, 0, 0.9);
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #00ff41;
        margin-top: 20px;
      }
      .shot-item {
        background: rgba(0, 255, 65, 0.05);
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
        border-left: 3px solid #00ff41;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üé± Live AI Commentary Test</h1>

      <div class="control-panel">
        <h3>üîå Connection Settings</h3>
        <div class="form-group">
          <label for="matchId">Match ID:</label>
          <input
            type="text"
            id="matchId"
            value="test-match-001"
            placeholder="Enter match ID"
          />
        </div>
        <div class="form-group">
          <label for="playerName">Player Name:</label>
          <input
            type="text"
            id="playerName"
            value="CyberPlayer"
            placeholder="Enter player name"
          />
        </div>
        <div class="form-group">
          <button id="connectBtn" onclick="connectToMatch()">
            üöÄ Connect to Match
          </button>
        </div>
        <div class="form-group">
          <button id="disconnectBtn" onclick="disconnectFromMatch()" disabled>
            ‚ùå Disconnect
          </button>
        </div>
      </div>

      <div id="status" class="status disconnected">Disconnected</div>

      <div class="control-panel">
        <h3>üéØ Simulate Shot</h3>
        <div class="form-group">
          <label for="shotType">Shot Type:</label>
          <select id="shotType">
            <option value="break">Break Shot</option>
            <option value="straight">Straight Shot</option>
            <option value="bank">Bank Shot</option>
            <option value="combo">Combo Shot</option>
            <option value="safety">Safety Shot</option>
          </select>
        </div>
        <div class="form-group">
          <label> <input type="checkbox" id="ballSunk" /> Ball Sunk </label>
        </div>
        <div class="form-group">
          <label> <input type="checkbox" id="wasFoul" /> Foul Committed </label>
        </div>
        <div class="form-group">
          <button onclick="simulateShot()" id="shotBtn" disabled>
            üé± Take Shot
          </button>
        </div>
      </div>

      <div class="commentary-display">
        <h3>üé§ Live AI Commentary</h3>
        <div id="commentaryContainer">
          <div class="commentary-item">
            <div class="commentary-text">
              Welcome to the cyberpunk pool arena!
            </div>
            <div class="commentary-details">System ‚Ä¢ Just now</div>
          </div>
        </div>
      </div>

      <div class="shot-history">
        <h3>üìä Shot History</h3>
        <div id="shotHistoryContainer">
          <div class="shot-item">No shots taken yet</div>
        </div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      let socket;
      let isConnected = false;

      function updateStatus(connected) {
        isConnected = connected;
        const statusEl = document.getElementById('status');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const shotBtn = document.getElementById('shotBtn');

        if (connected) {
          statusEl.textContent = 'Connected to Match';
          statusEl.className = 'status connected';
          connectBtn.disabled = true;
          disconnectBtn.disabled = false;
          shotBtn.disabled = false;
        } else {
          statusEl.textContent = 'Disconnected';
          statusEl.className = 'status disconnected';
          connectBtn.disabled = false;
          disconnectBtn.disabled = true;
          shotBtn.disabled = true;
        }
      }

      function connectToMatch() {
        const matchId = document.getElementById('matchId').value;
        const playerName = document.getElementById('playerName').value;

        if (!matchId || !playerName) {
          alert('Please enter both Match ID and Player Name');
          return;
        }

        // Connect to the WebSocket server
        socket = io('http://localhost:8080');

        socket.on('connect', () => {
          console.log('Connected to WebSocket server');

          // Join the match room
          socket.emit('joinMatch', { matchId });

          // Listen for live commentary
          socket.on('live_commentary', (data) => {
            displayCommentary(data);
            addShotToHistory(data);
          });

          updateStatus(true);
        });

        socket.on('disconnect', () => {
          console.log('Disconnected from WebSocket server');
          updateStatus(false);
        });

        socket.on('error', (error) => {
          console.error('WebSocket error:', error);
          alert('Connection error: ' + error.message);
          updateStatus(false);
        });
      }

      function disconnectFromMatch() {
        if (socket) {
          const matchId = document.getElementById('matchId').value;
          socket.emit('leaveMatch', { matchId });
          socket.disconnect();
          socket = null;
          updateStatus(false);
        }
      }

      function simulateShot() {
        if (!socket || !isConnected) {
          alert('Please connect to a match first');
          return;
        }

        const matchId = document.getElementById('matchId').value;
        const playerName = document.getElementById('playerName').value;
        const shotType = document.getElementById('shotType').value;
        const ballSunk = document.getElementById('ballSunk').checked;
        const wasFoul = document.getElementById('wasFoul').checked;

        // Emit the shot_taken event
        socket.emit('shot_taken', {
          matchId,
          playerId: 'player-' + Date.now(),
          ballSunk,
          wasFoul,
          playerName,
          shotType,
        });

        console.log('Shot event emitted:', {
          matchId,
          playerName,
          shotType,
          ballSunk,
          wasFoul,
        });
      }

      function displayCommentary(data) {
        const container = document.getElementById('commentaryContainer');
        const commentaryItem = document.createElement('div');
        commentaryItem.className = 'commentary-item';

        const timestamp = new Date(data.timestamp).toLocaleTimeString();

        commentaryItem.innerHTML = `
                <div class="commentary-text">${data.commentary}</div>
                <div class="commentary-details">
                    ${data.playerName} ‚Ä¢ ${data.shotType || 'shot'} ‚Ä¢ ${
          data.ballSunk ? 'Ball sunk' : 'Miss'
        } ‚Ä¢ ${data.wasFoul ? 'FOUL!' : 'Clean'} ‚Ä¢ ${timestamp}
                </div>
            `;

        container.insertBefore(commentaryItem, container.firstChild);

        // Keep only last 10 commentary items
        while (container.children.length > 10) {
          container.removeChild(container.lastChild);
        }
      }

      function addShotToHistory(data) {
        const container = document.getElementById('shotHistoryContainer');

        // Remove "No shots taken yet" message
        if (
          container.children.length === 1 &&
          container.firstChild.textContent === 'No shots taken yet'
        ) {
          container.removeChild(container.firstChild);
        }

        const shotItem = document.createElement('div');
        shotItem.className = 'shot-item';

        const timestamp = new Date(data.timestamp).toLocaleTimeString();
        const result = data.ballSunk ? '‚úÖ Ball sunk' : '‚ùå Miss';
        const foul = data.wasFoul ? 'üö® FOUL' : '‚úÖ Clean';

        shotItem.innerHTML = `
                <strong>${data.playerName}</strong> - ${
          data.shotType || 'shot'
        } ‚Ä¢ ${result} ‚Ä¢ ${foul} ‚Ä¢ ${timestamp}
            `;

        container.insertBefore(shotItem, container.firstChild);

        // Keep only last 10 shots
        while (container.children.length > 10) {
          container.removeChild(container.lastChild);
        }
      }

      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        if (socket) {
          socket.disconnect();
        }
      });
    </script>
  </body>
</html>
